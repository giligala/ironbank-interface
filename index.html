<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iron Bank USDT Market</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.5.1/dist/ethers.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        input {
            padding: 8px;
            margin: 5px 0;
            width: 200px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .stat-item {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Iron Bank USDT Market</h1>
        
        <div class="section">
            <button id="connectWallet">Connect Wallet</button>
            <p id="walletAddress">Wallet: Not Connected</p>
        </div>

        <div class="section">
            <h2>Market Statistics</h2>
            <div class="stats">
                <div class="stat-item">
                    <p>Total Supply: <span id="totalSupply">-</span> ibUSDT</p>
                </div>
                <div class="stat-item">
                    <p>Total Borrows: <span id="totalBorrows">-</span> USDT</p>
                </div>
                <div class="stat-item">
                    <p>Exchange Rate: <span id="exchangeRate">-</span></p>
                </div>
                <div class="stat-item">
                    <p>Borrow Rate: <span id="borrowRate">-</span>% APY</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Supply USDT</h2>
            <input type="number" id="supplyAmount" placeholder="Amount to supply">
            <button id="supplyButton">Supply</button>
        </div>

        <div class="section">
            <h2>Withdraw USDT</h2>
            <input type="number" id="withdrawAmount" placeholder="Amount to withdraw">
            <button id="withdrawButton">Withdraw</button>
        </div>

        <div class="section">
            <h2>Borrow USDT</h2>
            <input type="number" id="borrowAmount" placeholder="Amount to borrow">
            <button id="borrowButton">Borrow</button>
        </div>

        <div class="section">
            <h2>Repay USDT</h2>
            <input type="number" id="repayAmount" placeholder="Amount to repay">
            <button id="repayButton">Repay</button>
        </div>
    </div>

    <script>
        const CONTRACT_ADDRESS = '0x48759F220ed983db51fa7a8c0d2aAb8f3ce4166a';
        const USDT_ADDRESS = '0xdAC17F958D2ee523a2206206994597C13D831ec7';

        // ABI 定義（這裡只列出部分必要的ABI）
        const CONTRACT_ABI = [
            "function totalSupply() external view returns (uint256)",
            "function totalBorrows() external view returns (uint256)",
            "function exchangeRateStored() external view returns (uint256)",
            "function borrowRatePerBlock() external view returns (uint256)",
            "function mint(uint256) external returns (uint256)",
            "function redeem(uint256) external returns (uint256)",
            "function borrow(uint256) external returns (uint256)",
            "function repayBorrow(uint256) external returns (uint256)"
        ];

        let provider;
        let signer;
        let contract;

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    
                    const address = await signer.getAddress();
                    document.getElementById('walletAddress').innerText = `Wallet: ${address}`;
                    
                    updateMarketStats();
                } catch (error) {
                    console.error('Error connecting wallet:', error);
                }
            } else {
                alert('Please install MetaMask!');
            }
        }

        async function updateMarketStats() {
            try {
                const totalSupply = await contract.totalSupply();
                const totalBorrows = await contract.totalBorrows();
                const exchangeRate = await contract.exchangeRateStored();
                const borrowRate = await contract.borrowRatePerBlock();

                document.getElementById('totalSupply').innerText = ethers.utils.formatUnits(totalSupply, 6);
                document.getElementById('totalBorrows').innerText = ethers.utils.formatUnits(totalBorrows, 6);
                document.getElementById('exchangeRate').innerText = ethers.utils.formatUnits(exchangeRate, 18);
                document.getElementById('borrowRate').innerText = 
                    (Number(ethers.utils.formatUnits(borrowRate, 18)) * 2102400 * 100).toFixed(2);
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        // 事件監聽器
        document.getElementById('connectWallet').addEventListener('click', connectWallet);

        // 供應USDT
        document.getElementById('supplyButton').addEventListener('click', async () => {
            const amount = document.getElementById('supplyAmount').value;
            try {
                const tx = await contract.mint(ethers.utils.parseUnits(amount, 6));
                await tx.wait();
                updateMarketStats();
            } catch (error) {
                console.error('Error supplying:', error);
            }
        });

        // 其他按鈕的事件處理器類似...
    </script>
</body>
</html>